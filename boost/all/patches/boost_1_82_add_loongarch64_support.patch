From 87e437e0b8bcf6316e0cc822c8b51c84a1cabf0b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E5=90=B4=E5=B0=8F=E7=99=BD?= <296015668@qq.com>
Date: Wed, 5 Nov 2025 15:14:54 +0800
Subject: [PATCH] add loongarch64 support for boost 1.81

---
 boostcpp.jam                                  |  5 +++--
 libs/config/checks/architecture/Jamfile.jam   |  1 +
 libs/config/checks/architecture/loongarch.cpp | 11 +++++++++++
 3 files changed, 15 insertions(+), 2 deletions(-)
 create mode 100644 libs/config/checks/architecture/loongarch.cpp

diff --git a/boostcpp.jam b/boostcpp.jam
index 082536e2a..7565dae80 100644
--- a/boostcpp.jam
+++ b/boostcpp.jam
@@ -634,7 +634,7 @@ rule address-model ( )
     return <conditional>@boostcpp.deduce-address-model ;
 }
 
-local deducable-architectures = arm mips1 power riscv s390x sparc x86 combined ;
+local deducable-architectures = arm loongarch mips1 power riscv s390x sparc x86 combined ;
 feature.feature deduced-architecture : $(deducable-architectures) : propagated optional composite hidden ;
 for a in $(deducable-architectures)
 {
@@ -645,9 +645,10 @@ rule deduce-architecture ( properties * )
 {
     local result ;
     local filtered = [ toolset-properties $(properties) ] ;
-    local names = arm mips1 power riscv s390x sparc x86 combined ;
+    local names = arm loongarch mips1 power riscv s390x sparc x86 combined ;
     local idx = [ configure.find-builds "default architecture" : $(filtered)
         : /boost/architecture//arm
+        : /boost/architecture//loongarch
         : /boost/architecture//mips1
         : /boost/architecture//power
         : /boost/architecture//riscv
diff --git a/libs/config/checks/architecture/Jamfile.jam b/libs/config/checks/architecture/Jamfile.jam
index c3779d917..ea41afb4a 100644
--- a/libs/config/checks/architecture/Jamfile.jam
+++ b/libs/config/checks/architecture/Jamfile.jam
@@ -18,6 +18,7 @@ obj 64 : 64.cpp ;
 
 obj arm      : arm.cpp ;
 obj combined : combined.cpp ;
+obj loongarch : loongarch.cpp ;
 obj mips     : mips.cpp ;
 alias mips1  : mips ; # Backwards compatibility
 obj power    : power.cpp ;
diff --git a/libs/config/checks/architecture/loongarch.cpp b/libs/config/checks/architecture/loongarch.cpp
new file mode 100644
index 000000000..5be8cb09b
--- /dev/null
+++ b/libs/config/checks/architecture/loongarch.cpp
@@ -0,0 +1,11 @@
+// loongarch.cpp
+//
+// Copyright (c) 2012 Steven Watanabe
+//
+// Distributed under the Boost Software License Version 1.0. (See
+// accompanying file LICENSE_1_0.txt or copy at
+// http://www.boost.org/LICENSE_1_0.txt)
+
+#if !defined(__loongarch__)
+#error "Not LoongArch"
+#endif
-- 
2.51.0

